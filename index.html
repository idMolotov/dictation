<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="apple-touch-icon" sizes="76x76" href="../assets/img/apple-icon.png">
    <link rel="icon" type="image/png" href="../assets/img/favicon.png">
    <title>
        Learning English Words
    </title>
</head>

<body class="" style="font-size: 40pt;font-family:'Comic Sans MS'; ">
<div style="display: none;">
    <h1>Speech synthesiser</h1>

    <p>Enter some text in the input below and press return or the "play" button to hear it. change voices using the dropdown menu.</p>

    <form>
        <input type="text" class="txt">
        <div>
            <label for="rate">Rate</label><input type="range" min="0.5" max="2" value="1" step="0.1" id="rate">
            <div class="rate-value">1</div>
            <div class="clearfix"></div>
        </div>
        <div>
            <label for="pitch">Pitch</label><input type="range" min="0" max="2" value="1" step="0.1" id="pitch">
            <div class="pitch-value">1</div>
            <div class="clearfix"></div>
        </div>
        <select>
            <option selected data-lang="en-US" data-name="Alex">Alex (en-US) -- DEFAULT</option>
        </select>
        <div class="controls">
            <button id="play" type="submit">Play</button>
        </div>
    </form>

</div>
<div>
    <div id="translation_en" style="display: block;width: 100%;margin-bottom: 10px;">
    </div>
    <div id="translation_ru" style="display: block;width: 100%;margin-bottom: 10px;">
        &nbsp;
    </div>
    <div style="display: block;width: 100%;">
        <input id="block_action" type="button" value="show translation" style="display: inline-block; height: 40px;">
    </div>
</div>
<script type="application/javascript">
    let classLessonsList = classLessonsList || {
        // 'class_3': {
        //     'lesson_15': 
        // }
    };
</script>

<script crossorigin="anonymous" defer="defer" type="application/javascript" src="./data/class_3_lesson_15.js"></script>
<script type="application/javascript">
   
    var speechS = window.speechSynthesis;

    var inputForm = document.querySelector('form');
    var inputTxt = document.querySelector('.txt');
    var voiceSelect = document.querySelector('select');

    var pitch = document.querySelector('#pitch');
    var pitchValue = document.querySelector('.pitch-value');
    var rate = document.querySelector('#rate');
    var rateValue = document.querySelector('.rate-value');

    var voices = [];

    // function populateVoiceList() {
    //     voices = synth.getVoices().sort(function (a, b) {
    //         const aname = a.name.toUpperCase(), bname = b.name.toUpperCase();
    //         if (aname < bname) return -1;
    //         else if (aname == bname) return 0;
    //         else return +1;
    //     });
    //     var selectedIndex = voiceSelect.selectedIndex < 0 ? 0 : voiceSelect.selectedIndex;
    //     voiceSelect.innerHTML = '';
    //     for (i = 0; i < voices.length; i++) {
    //         var option = document.createElement('option');
    //         option.textContent = voices[i].name + ' (' + voices[i].lang + ')';
    //
    //         if (voices[i].default) {
    //             option.textContent += ' -- DEFAULT';
    //         }
    //
    //         option.setAttribute('data-lang', voices[i].lang);
    //         option.setAttribute('data-name', voices[i].name);
    //         voiceSelect.appendChild(option);
    //     }
    //     voiceSelect.selectedIndex = selectedIndex;
    // }
    //
    // populateVoiceList();

    if (speechSynthesis.onvoiceschanged !== undefined) {
        speechSynthesis.onvoiceschanged = populateVoiceList;
    }

    function speak(someTextValue) {
        if (speechS.speaking) {
            console.error('speechSynthesis.speaking');
            return;
        }
        if (someTextValue !== '') {
            var utterThis = new SpeechSynthesisUtterance(someTextValue);
            utterThis.onend = function (event) {
                console.log('SpeechSynthesisUtterance.onend');
            }
            utterThis.onerror = function (event) {
                console.error('SpeechSynthesisUtterance.onerror');
            }
            var selectedOption = voiceSelect.selectedOptions[0].getAttribute('data-name');
            for (i = 0; i < voices.length; i++) {
                if (voices[i].name === selectedOption) {
                    utterThis.voice = voices[i];
                    break;
                }
            }
            utterThis.pitch = pitch.value;
            utterThis.rate = rate.value;
            speechS.speak(utterThis);
        }
    }

    inputForm.onsubmit = function (event) {
        event.preventDefault();

        speak();

        inputTxt.blur();
    }

    pitch.onchange = function () {
        pitchValue.textContent = pitch.value;
    }

    rate.onchange = function () {
        rateValue.textContent = rate.value;
    }

    voiceSelect.onchange = function () {
        speak();
    }
</script>
<script type="application/javascript">
    console.log('classLessonsList',classLessonsList);
    const sourceWords = classLessonsList['class_3']['lesson_15'] ;

    // const fromLang = 'en';
    // const toLang = 'ru';
    const fromLang = 'ru';
    const toLang = 'en';

    function getRandomWordData() {
        return sourceWords[Math.round(Math.random() * (sourceWords.length - 1))];
    }

    function clearForm() {
        ['ru', 'en'].forEach((sourceLang) => {
            const fromId = 'translation_' + sourceLang;
            document.getElementById(fromId).innerText = '';
        })
    }

    function getRandomListElement(sourceList) {
        return sourceList[Math.round(Math.random() * (sourceList.length - 1))];
    }

    function initForm() {
        const fromId = 'translation_' + fromLang;
        const toId = 'translation_' + toLang;
        console.log('fromId', fromId);

        const wordData = getRandomWordData();
        // document.getElementById(fromId).innerText = wordData[sourceLang];
        document.getElementById(fromId).innerHTML = wordData[fromLang].join(',');
        document.getElementById(toId).innerHTML = '?';

        document.getElementById('block_action').value = 'show translation';
        document.getElementById('block_action').onclick = () => {
            document.getElementById('block_action').value = 'next word';
            document.getElementById(toId).innerHTML = getRandomListElement(wordData[toLang]);
            document.getElementById(toId).innerHTML = wordData[toLang].join(',');
            if (toLang === 'en') speak(wordData[toLang][0]);
            document.getElementById('block_action').onclick = () => {
                initForm();
            };
        };
        if (fromLang === 'en') speak(document.getElementById(fromId).innerHTML);
    }
</script>

<script>
    initForm();
</script>
</body>
